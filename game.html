<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Echo Maze â€” Neon Escape</title>
  <style>
    body,html {
      margin:0; padding:0; height:100%;
      background:#05050a; overflow:hidden;
      font-family:'Inter',sans-serif; color:#eaf0ff;
      display:flex; justify-content:center; align-items:center;
    }
    canvas {
      display:block;
      background:radial-gradient(circle at 50% 50%,#000010,#000);
      border-radius:16px;
      box-shadow:0 0 50px rgba(0,200,255,0.25),
                 0 0 120px rgba(0,200,255,0.1) inset;
    }
    #overlay {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      text-align:center; color:#cfeaff;
      padding:20px 40px; border-radius:20px;
      background:rgba(0,0,20,0.85);
      box-shadow:0 0 40px rgba(0,200,255,0.5);
      backdrop-filter:blur(6px);
      max-width:80%;
    }
    #overlay h1 {
      font-size:48px; margin:0 0 20px;
      text-shadow:0 0 25px rgba(0,200,255,0.8);
    }
    #overlay p {
      font-size:18px; opacity:0.9; margin-bottom:20px; line-height:1.4;
    }
    #overlay button {
      margin-top:12px; padding:12px 22px;
      border:none; border-radius:12px;
      background:linear-gradient(90deg,#00c8ff,#00ffa6);
      color:#000; font-weight:bold; cursor:pointer;
      box-shadow:0 0 20px rgba(0,255,200,0.5);
      transition:transform 0.2s,box-shadow 0.2s;
      font-size:16px;
    }
    #overlay button:hover {
      transform:scale(1.05);
      box-shadow:0 0 30px rgba(0,255,200,0.7);
    }
    #hud {
      position:absolute; top:16px; left:50%;
      transform:translateX(-50%);
      font-size:18px; color:#0ff;
      text-shadow:0 0 15px rgba(0,255,200,0.9);
      background:rgba(0,0,20,0.7);
      padding:6px 12px;
      border-radius:10px;
    }
  </style>
</head>
<body>
  <canvas id="game" width="900" height="600"></canvas>
  <div id="overlay">
    <h1>Echo Maze</h1>
    <p>Use <b>Arrow Keys / WASD</b> to move.<br>
    Press <b>SPACE</b> or <b>Click</b> to send a sonar pulse.<br>
    Find the glowing exit!</p>
    <button id="startBtn">Start Game</button>
  </div>
  <div id="hud"></div>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
let W=canvas.width,H=canvas.height;

let running=false, keys={}, player, maze, exitPulse=0, sonar=[], level=1, score=0, particles=[], echoes=5, lives=3;

function reset(){
  let cols = 16 + (level-1)*3;
  let rows = 12 + (level-1)*2;
  let cellSize = Math.min(W/cols, H/rows);
  let wallChance = Math.min(0.22 + (level-1)*0.05, 0.45);

  player={x:cellSize/2,y:cellSize/2,r:10,speed:160};
  maze=generateMaze(cols, rows, cellSize, wallChance);
  sonar=[];exitPulse=0;particles=[];
  echoes=5; lives=3;
  updateHUD();
}

function generateMaze(cols, rows, cellSize, wallChance){
  let grid=[];
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(Math.random()<wallChance) grid.push({x:c*cellSize,y:r*cellSize,w:cellSize,h:cellSize});
    }
  }
  return grid;
}

function ping(){
  if(echoes>0){
    sonar.push({x:player.x,y:player.y,r:0,max:220});
    echoes--;
  }
}

function update(dt){
  let dx=(keys['ArrowRight']||keys['d']?1:0)-(keys['ArrowLeft']||keys['a']?1:0);
  let dy=(keys['ArrowDown']||keys['s']?1:0)-(keys['ArrowUp']||keys['w']?1:0);
  let len=Math.hypot(dx,dy); if(len>0){dx/=len;dy/=len;}
  player.x+=dx*player.speed*dt;
  player.y+=dy*player.speed*dt;

  for(const wall of maze){
    if(player.x>wall.x&&player.x<wall.x+wall.w&&player.y>wall.y&&player.y<wall.y+wall.h){
      lives--; 
      if(lives<=0){
        running=false;
        document.getElementById('overlay').style.display='block';
        document.getElementById('overlay').innerHTML='<h1>Game Over</h1><p>Score: '+score+'<br><button id="restartBtn">Restart</button></p>';
        document.getElementById('restartBtn').onclick=()=>{
          level=1;score=0;reset();running=true;
          document.getElementById('overlay').style.display='none';
          last=performance.now();requestAnimationFrame(loop);
        };
      }
      if(dx>0) player.x=wall.x; if(dx<0) player.x=wall.x+wall.w;
      if(dy>0) player.y=wall.y; if(dy<0) player.y=wall.y+wall.h;
    }
  }

  for(const s of sonar){s.r+=220*dt;}
  sonar=sonar.filter(s=>s.r<s.max);

  exitPulse+=dt;

  particles.push({x:player.x+Math.random()*8-4, y:player.y+Math.random()*8-4, r:Math.random()*2+1, life:0.6});
  particles=particles.filter(p=>(p.life-=dt)>0);
}

function draw(){
  ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);

  for(const s of sonar){
    const g=ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,s.r);
    g.addColorStop(0,'rgba(0,200,255,0.35)');
    g.addColorStop(0.5,'rgba(0,200,255,0.08)');
    g.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=g;ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
  }

  const ex={x:W-80,y:H-80};
  let pulse=30+Math.sin(exitPulse*5)*10;
  const eg=ctx.createRadialGradient(ex.x,ex.y,0,ex.x,ex.y,pulse);
  eg.addColorStop(0,'rgba(0,255,180,0.9)');
  eg.addColorStop(0.5,'rgba(0,200,255,0.25)');
  eg.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle=eg;ctx.beginPath();ctx.arc(ex.x,ex.y,pulse,0,Math.PI*2);ctx.fill();

  ctx.save();
  ctx.fillStyle='rgba(120,180,255,0.25)';
  for(const wall of maze){
    for(const s of sonar){
      const cx=wall.x+wall.w/2,cy=wall.y+wall.h/2;
      if(Math.hypot(cx-s.x,cy-s.y)<s.r+80){
        ctx.shadowColor='rgba(0,200,255,0.8)';
        ctx.shadowBlur=12;
        ctx.fillRect(wall.x,wall.y,wall.w,wall.h);
      }
    }
  }
  ctx.restore();

  ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle='#fff';ctx.fill();
  const pg=ctx.createRadialGradient(player.x,player.y,2,player.x,player.y,30);
  pg.addColorStop(0,'#0ff');pg.addColorStop(1,'transparent');
  ctx.fillStyle=pg;ctx.beginPath();ctx.arc(player.x,player.y,30,0,Math.PI*2);ctx.fill();

  for(const p of particles){
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle='rgba(0,255,200,'+(p.life*0.7)+')';
    ctx.fill();
  }

  if(Math.hypot(player.x-ex.x,player.y-ex.y)<25){
    running=false;
    level++; score+=Math.floor(Math.random()*100)+50;
    document.getElementById('overlay').style.display='block';
    document.getElementById('overlay').innerHTML='<h1>Level '+(level-1)+' Complete!</h1><p>Score: '+score+'<br>Next Level: '+level+'<br><button id="nextLevelBtn">Next Level</button></p>';
    document.getElementById('nextLevelBtn').onclick=()=>{
      reset();running=true;document.getElementById('overlay').style.display='none';
      last=performance.now();requestAnimationFrame(loop);
    };
  }
}

function updateHUD(){
  document.getElementById('hud').innerHTML='Level: '+level+' | Score: '+score+' | Echoes: '+echoes+' | Lives: '+lives;
}

let last=0;
function loop(ts){if(!running) return;let dt=(ts-last)/1000;last=ts;update(dt);draw();updateHUD();requestAnimationFrame(loop);}

window.addEventListener('keydown',e=>{keys[e.key]=true;if(e.key===' '){ping();}});
window.addEventListener('keyup',e=>{keys[e.key]=false;});
canvas.addEventListener('click',()=>{if(running){ping();}});

document.getElementById('startBtn').onclick=()=>{
  reset();running=true;document.getElementById('overlay').style.display='none';
  last=performance.now();requestAnimationFrame(loop);
};

// show intro screen first
reset();draw();
</script>
</body>
</html>
